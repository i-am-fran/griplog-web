<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

    <!-- Primary Meta Tags -->
    <title>Opening Griplog...</title>
    <meta name="title" content="Opening Griplog">
    <meta name="description" content="Redirecting you to Griplog app">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">

    <!-- Stylesheet -->
    <link rel="stylesheet" href="css/styles.css">

    <style>
        .redirect-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            text-align: center;
        }

        .redirect-content {
            max-width: 600px;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--accent-color, #007AFF);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .redirect-message {
            font-size: 1.125rem;
            margin: 1.5rem 0;
            color: rgba(255, 255, 255, 0.9);
        }

        .redirect-fallback {
            display: none;
            margin-top: 2rem;
        }

        .redirect-button {
            display: inline-block;
            padding: 0.875rem 1.75rem;
            background: var(--accent-color, #007AFF);
            color: white;
            text-decoration: none;
            border-radius: 12px;
            font-weight: 600;
            margin-top: 1rem;
            transition: opacity 0.2s;
        }

        .redirect-button:hover {
            opacity: 0.8;
        }

        .error-message {
            display: none;
            color: #FF3B30;
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(255, 59, 48, 0.1);
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="redirect-container">
        <div class="redirect-content">
            <img src="images/app-icon.png" alt="Griplog App Icon" class="app-icon" style="width: 96px; height: 96px; border-radius: 22px;">

            <div class="spinner"></div>

            <h1 class="redirect-message">Opening Griplog...</h1>

            <p style="color: rgba(255, 255, 255, 0.6); font-size: 0.875rem;">
                If the app doesn't open automatically, tap the button below.
            </p>

            <div class="redirect-fallback" id="fallback">
                <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 1rem;">
                    Don't have Griplog installed?
                </p>
                <a href="https://apps.apple.com/app/griplog/id6738360928" class="redirect-button" target="_blank">
                    Download from App Store
                </a>
                <br>
                <button onclick="retryRedirect()" class="redirect-button" style="background: transparent; border: 1px solid rgba(255, 255, 255, 0.3); margin-top: 1rem;">
                    Try Opening Again
                </button>
            </div>

            <div class="error-message" id="error">
                <strong>Invalid Link</strong><br>
                This link appears to be invalid or corrupted. Please ask the sender to share it again.
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>
            © 2025 • <a href="/">Griplog</a> •  •
            <a href="/roadmap">Roadmap</a> •
            <a href="/url-builder">URL Builder</a>
        </p>
    </footer>

    <script>
        // Extract the x-callback-url from the query parameter
        const urlParams = new URLSearchParams(window.location.search);
        const encodedUrl = urlParams.get('url');

        if (!encodedUrl) {
            // No URL parameter provided
            document.querySelector('.spinner').style.display = 'none';
            document.querySelector('.redirect-message').textContent = 'Invalid Link';
            document.getElementById('error').style.display = 'block';
        } else {
            try {
                // Decode the URL
                const xCallbackUrl = decodeURIComponent(encodedUrl);

                // Log for debugging (remove in production if needed)
                console.log('Redirecting to:', xCallbackUrl);

                // Attempt to redirect immediately
                window.location.href = xCallbackUrl;

                // Show fallback after 2 seconds
                setTimeout(() => {
                    document.querySelector('.redirect-message').textContent = 'App Not Opening?';
                    document.getElementById('fallback').style.display = 'block';
                }, 2000);

                // Function to retry the redirect
                window.retryRedirect = function() {
                    window.location.href = xCallbackUrl;
                };

            } catch (error) {
                // Decoding failed
                console.error('Failed to decode URL:', error);
                document.querySelector('.spinner').style.display = 'none';
                document.querySelector('.redirect-message').textContent = 'Invalid Link';
                document.getElementById('error').style.display = 'block';
            }
        }
    </script>
</body>
</html>
